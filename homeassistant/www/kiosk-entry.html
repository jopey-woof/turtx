<!DOCTYPE html>
<html>
<head>
    <title>üê¢ Turtle System - Kiosk</title>
    <style>
        body {
            background: linear-gradient(135deg, #2D5016, #4A7C59);
            color: #E8F5E8;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        .container {
            text-align: center;
        }
        .turtle {
            font-size: 4em;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        .status {
            margin-top: 20px;
            font-size: 1.2em;
        }
        .loading {
            margin-top: 20px;
            width: 50px;
            height: 50px;
            border: 3px solid #E8F5E8;
            border-top: 3px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="turtle">üê¢</div>
        <div>Turtle Habitat Monitor</div>
        <div class="status" id="status">Initializing system...</div>
        <div class="loading" id="loading"></div>
    </div>
    
    <script>
        console.log('üê¢ Turtle kiosk entry point loaded');
        
        const statusEl = document.getElementById('status');
        const loadingEl = document.getElementById('loading');
        
        function updateStatus(message) {
            statusEl.textContent = message;
            console.log('üê¢ Status:', message);
        }
        
        function redirectToHA() {
            updateStatus('Connecting to Home Assistant...');
            
            // Create an iframe to load Home Assistant with auto-login
            const iframe = document.createElement('iframe');
            iframe.src = '/lovelace-kiosk';
            iframe.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border: none;
                z-index: 1000;
            `;
            
            // Add auto-login script to the iframe
            iframe.onload = function() {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    
                    // Inject the auto-login script
                    const script = iframeDoc.createElement('script');
                    script.src = '/local/kiosk-auto-login.js';
                    iframeDoc.head.appendChild(script);
                    
                    updateStatus('Auto-login script injected');
                    
                    // Hide the loading screen after a delay
                    setTimeout(() => {
                        document.body.style.display = 'none';
                    }, 3000);
                    
                } catch (e) {
                    console.log('üê¢ Could not inject script into iframe:', e);
                    // Fallback: redirect directly
                    window.location.href = '/lovelace-kiosk';
                }
            };
            
            document.body.appendChild(iframe);
        }
        
        // Start the process
        setTimeout(() => {
            updateStatus('Checking Home Assistant...');
            
            // Check if Home Assistant is accessible
            fetch('/api/')
                .then(response => {
                    if (response.ok) {
                        updateStatus('Home Assistant ready, starting auto-login...');
                        setTimeout(redirectToHA, 1000);
                    } else {
                        updateStatus('Home Assistant not ready, retrying...');
                        setTimeout(redirectToHA, 3000);
                    }
                })
                .catch(error => {
                    console.log('üê¢ Home Assistant not accessible:', error);
                    updateStatus('Home Assistant not accessible, retrying...');
                    setTimeout(redirectToHA, 5000);
                });
        }, 2000);
    </script>
</body>
</html> 