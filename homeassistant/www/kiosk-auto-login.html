<!DOCTYPE html>
<html>
<head>
    <title>üê¢ Turtle System - Auto Login</title>
    <style>
        body {
            background: linear-gradient(135deg, #2D5016, #4A7C59);
            color: #E8F5E8;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            text-align: center;
        }
        .turtle {
            font-size: 4em;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        .status {
            margin-top: 20px;
            font-size: 1.2em;
        }
        .error {
            color: #ff6b6b;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="turtle">üê¢</div>
        <div>Turtle System</div>
        <div class="status" id="status">Connecting to habitat...</div>
        <div class="error" id="error" style="display: none;"></div>
    </div>
    
    <script>
        console.log("üê¢ Turtle auto-login starting...");
        
        const statusEl = document.getElementById('status');
        const errorEl = document.getElementById('error');
        
        function showError(message) {
            statusEl.textContent = 'Connection failed';
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }
        
        function autoLogin() {
            statusEl.textContent = 'Attempting auto-login...';
            
            // Try to access Home Assistant with stored token
            const token = localStorage.getItem('hassTokens');
            
            if (token) {
                try {
                    const tokens = JSON.parse(token);
                    if (tokens.access_token) {
                        statusEl.textContent = 'Using stored token...';
                        
                        // Set the token and redirect to dashboard
                        localStorage.setItem('hassTokens', token);
                        window.location.href = '/lovelace-kiosk';
                        return;
                    }
                } catch (e) {
                    console.log('Invalid stored token, will try manual login');
                }
            }
            
            // If no valid token, try manual login
            statusEl.textContent = 'Redirecting to login...';
            setTimeout(() => {
                window.location.href = '/auth/login_flow';
            }, 1000);
        }
        
        // Wait for Home Assistant to be ready
        setTimeout(autoLogin, 2000);
    </script>
</body>
</html>
