<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üê¢ TurtX Monitor</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        /* Page Management */
        .page {
            height: 100vh;
            width: 100vw;
            display: none;
            flex-direction: column;
            position: absolute;
            top: 0;
            left: 0;
            transition: all 0.3s ease;
        }

        .page.active {
            display: flex;
        }

        /* Animated Header - 15vh */
        .header {
            height: 15vh;
            position: relative;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0c29 100%);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        /* Twinkling Star Field Background */
        .star-field {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* Moon Phase Display */
        .moon-phase {
            position: absolute;
            top: 1vh;
            right: 2vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
            color: #fff;
            text-align: center;
        }

        .moon-icon {
            font-size: clamp(1.5rem, 3vw, 2.5rem);
            margin-bottom: 0.5vh;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
            animation: moon-glow 4s ease-in-out infinite alternate;
        }

        .moon-info {
            font-size: clamp(0.6rem, 1.2vw, 0.8rem);
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .moon-phase-name {
            font-size: clamp(0.5rem, 1vw, 0.7rem);
            opacity: 0.9;
            margin-top: 0.2vh;
        }

        @keyframes moon-glow {
            0% { filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5)); }
            100% { filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.8)); }
        }

        /* Nyan Turtle Container */
        .nyan-turtle-container {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            height: 8vh;
            z-index: 5;
            overflow: hidden;
        }

        .nyan-turtle-visible {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: clamp(2rem, 4vw, 3rem);
            z-index: 8;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
        }

        .nyan-star-overlay {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            z-index: 6;
            pointer-events: none;
        }

        .nyan-star {
            position: absolute;
            color: #fff;
            font-size: 0.8rem;
            animation: nyan-star-fall 2s linear infinite;
        }

        @keyframes nyan-star-fall {
            0% { transform: translateX(0) translateY(0); opacity: 1; }
            100% { transform: translateX(-100px) translateY(20px); opacity: 0; }
        }

        /* Header Title */
        .header-title {
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 700;
            z-index: 10;
            position: relative;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header-subtitle {
            position: absolute;
            bottom: 1vh;
            font-size: clamp(0.8rem, 1.5vw, 1rem);
            opacity: 0.8;
            z-index: 10;
        }

        /* Main Cards - 45vh */
        .main-cards {
            height: 45vh;
            display: flex;
            gap: 2vw;
            padding: 2vh 2vw;
            overflow: hidden;
        }

        .sensor-card {
            flex: 1;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2vh 1vw;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .sensor-card:hover {
            transform: translateY(-5px);
        }

        .zone-icon {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 1vh;
        }

        .zone-title {
            font-size: clamp(1rem, 2.5vw, 1.5rem);
            font-weight: 600;
            margin-bottom: 2vh;
        }

        .temp-value {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: bold;
            margin-bottom: 1vh;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .humidity-value {
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            margin-bottom: 2vh;
            opacity: 0.9;
        }

        .status-bar {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            margin-top: auto;
        }

        .status-excellent { background: #4ade80; }
        .status-warning { background: #facc15; }
        .status-critical { background: #ef4444; }

        /* Weather Card - 10vh */
        .weather-card {
            height: 10vh;
            margin: 0 2vw;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1vh 2vw;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 2vw;
        }

        .weather-icon {
            font-size: clamp(1.5rem, 4vw, 2rem);
        }

        .weather-info {
            flex: 1;
            font-size: clamp(0.8rem, 2vw, 1rem);
        }

        /* System Indicators - 20vh */
        .system-indicators {
            height: 20vh;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 2vw;
            gap: 1vw;
        }

        .indicator {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1vh;
            padding: 1vh;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .indicator:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.2);
        }

        .indicator-icon {
            font-size: clamp(1.5rem, 3vw, 2rem);
        }

        .indicator-label {
            font-size: clamp(0.7rem, 1.5vw, 0.9rem);
            font-weight: 600;
            text-align: center;
        }

        .indicator-status {
            font-size: clamp(0.6rem, 1.2vw, 0.8rem);
            font-weight: 600;
            padding: 0.2vh 0.5vw;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
        }

        /* Navigation - 10vh */
        .navigation {
            height: 10vh;
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5vh;
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: clamp(0.8rem, 1.5vw, 1rem);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-bottom: 3px solid #4ade80;
        }

        .nav-icon {
            font-size: clamp(1.5rem, 3vw, 2rem);
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 1vh;
            left: 2vw;
            display: flex;
            align-items: center;
            gap: 0.5vw;
            padding: 0.5vh 1vw;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            font-size: clamp(0.7rem, 1.2vw, 0.9rem);
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .connection-status.connected {
            background: rgba(74, 222, 128, 0.8);
        }

        .connection-status.disconnected {
            background: rgba(239, 68, 68, 0.8);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Camera Page Styles */
        .camera-container {
            height: 55vh;
            display: flex;
            flex-direction: column;
            padding: 2vh 2vw;
            gap: 2vh;
        }

        .camera-feed {
            flex: 1;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .camera-stream {
            max-width: 100%;
            max-height: 100%;
            border-radius: 15px;
        }

        .camera-status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(1.2rem, 2.5vw, 1.8rem);
            text-align: center;
            z-index: 10;
        }

        .camera-status.online {
            color: #4ade80;
        }

        .camera-status.offline {
            color: #ef4444;
        }

        .camera-controls {
            display: flex;
            gap: 1vw;
            justify-content: center;
        }

        .control-btn {
            padding: 1vh 2vw;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: clamp(0.8rem, 1.5vw, 1rem);
        }

        .control-btn:hover {
            transform: scale(1.05);
        }

        /* Data Page Specific */
        .page-header {
            height: 10vh;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2vw;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .data-charts {
            height: 35vh;
            display: flex;
            gap: 2vw;
            padding: 2vh 2vw;
        }

        .chart-card {
            flex: 1;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2vh 1vw;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
        }

        .chart-title {
            font-size: clamp(0.9rem, 2.2vw, 1.2rem);
            font-weight: 600;
            margin-bottom: 1vh;
            text-align: center;
        }

        .chart-values {
            display: flex;
            justify-content: space-around;
            margin-bottom: 2vh;
            font-size: clamp(0.8rem, 1.8vw, 1rem);
        }

        .chart-placeholder {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: clamp(0.7rem, 1.5vw, 0.9rem);
            opacity: 0.7;
        }

        .activity-log {
            height: 35vh;
            margin: 0 2vw;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2vh;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2vh;
        }

        .log-filters {
            display: flex;
            gap: 0.5vw;
        }

        .filter-btn {
            padding: 0.5vh 1vw;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 15px;
            color: #fff;
            cursor: pointer;
            font-size: clamp(0.6rem, 1.2vw, 0.8rem);
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: rgba(74, 222, 128, 0.6);
        }

        .log-entries {
            height: calc(100% - 4vh);
            overflow-y: auto;
            font-size: clamp(0.7rem, 1.4vw, 0.9rem);
        }

        .log-entry {
            padding: 0.5vh 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .log-entry:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <!-- Page 1: Status Overview -->
    <div class="page active" id="status-page">
        <!-- Connection Status -->
        <div class="connection-status" id="connection-status">
            <span class="connection-icon">üì°</span>
            <span class="connection-text">Connecting...</span>
        </div>

        <!-- Animated Header - 15vh -->
        <div class="header">
            <!-- Twinkling Star Field -->
            <div class="star-field" id="star-field"></div>

            <!-- Moon Phase Display -->
            <div class="moon-phase" id="moon-phase">
                <div class="moon-icon" id="moon-icon">üåô</div>
                <div class="moon-info" id="moon-info">Loading...</div>
                <div class="moon-phase-name" id="moon-phase-name"></div>
            </div>

            <!-- Nyan Turtle Container -->
            <div class="nyan-turtle-container">
                <!-- Nyan Turtle (Using emoji for now, ready for GIF replacement) -->
                <div class="nyan-turtle-visible">üê¢</div>
                
                <!-- Star Overlay Trail -->
                <div class="nyan-star-overlay" id="nyan-star-overlay"></div>
            </div>

            <!-- Header Title -->
            <h1 class="header-title">TurtX Monitor</h1>
            <div class="header-subtitle">Live Habitat Monitoring System</div>
        </div>

        <!-- Main Cards - 45vh -->
        <div class="main-cards">
            <div class="sensor-card">
                <div class="zone-icon">üî•</div>
                <div class="zone-title">Basking Zone</div>
                <div class="temp-value" id="basking-temp">--¬∞F</div>
                <div class="humidity-value">Humidity: <span id="basking-humidity">--%</span></div>
                <div class="status-bar status-excellent" id="basking-status"></div>
            </div>
            <div class="sensor-card">
                <div class="zone-icon">‚ùÑÔ∏è</div>
                <div class="zone-title">Cool Zone</div>
                <div class="temp-value" id="cooling-temp">--¬∞F</div>
                <div class="humidity-value">Humidity: <span id="cooling-humidity">--%</span></div>
                <div class="status-bar status-excellent" id="cooling-status"></div>
            </div>
        </div>

        <!-- Weather Card - 10vh -->
        <div class="weather-card">
            <div class="weather-icon">üå§Ô∏è</div>
            <div class="weather-info">
                <div>Portland, OR - <span id="weather-temp">--¬∞F</span> - <span id="weather-desc">Loading...</span></div>
                <div>Wind: <span id="weather-wind">-- mph</span> | Humidity: <span id="weather-humidity">--%</span></div>
            </div>
        </div>

        <!-- System Indicators - 20vh -->
        <div class="system-indicators">
            <div class="indicator">
                <div class="indicator-icon">üå°Ô∏è</div>
                <div class="indicator-label">Heater</div>
                <div class="indicator-status status-excellent">ON</div>
            </div>
            <div class="indicator">
                <div class="indicator-icon">üí°</div>
                <div class="indicator-label">UV Light</div>
                <div class="indicator-status status-excellent">ON</div>
            </div>
            <div class="indicator">
                <div class="indicator-icon">‚ö°</div>
                <div class="indicator-label">Power</div>
                <div class="indicator-status status-excellent">OK</div>
            </div>
            <div class="indicator">
                <div class="indicator-icon">üì°</div>
                <div class="indicator-label">Network</div>
                <div class="indicator-status" id="network-status">OK</div>
            </div>
            <div class="indicator">
                <div class="indicator-icon">üö®</div>
                <div class="indicator-label">Alerts</div>
                <div class="indicator-status" id="alerts-status">0</div>
            </div>
        </div>

        <!-- Navigation - 10vh -->
        <div class="navigation">
            <button class="nav-btn active" onclick="showPage('status')">
                <div class="nav-icon">üè†</div>
                <div>STATUS</div>
            </button>
            <button class="nav-btn" onclick="showPage('camera')">
                <div class="nav-icon">üìπ</div>
                <div>CAMERA</div>
            </button>
            <button class="nav-btn" onclick="showPage('data')">
                <div class="nav-icon">üìä</div>
                <div>DATA</div>
            </button>
        </div>
    </div>

    <!-- Page 2: Camera View -->
    <div class="page" id="camera-page">
        <!-- Header - 15vh -->
        <div class="header">
            <h1>üìπ Live Camera Feed</h1>
        </div>

        <!-- Camera Container - 55vh -->
        <div class="camera-container">
            <div class="camera-feed">
                <!-- Camera Status Indicator -->
                <div class="camera-status offline" id="camera-status">
                    üìπ Camera Offline
                </div>
                
                <!-- Live Camera Stream -->
                <img class="camera-stream"
                     id="camera-stream"
                     style="display: none;"
                     alt="Turtle Camera Feed" />
                
                <!-- Camera Placeholder -->
                <div class="camera-placeholder" id="camera-placeholder">
                    üê¢ Turtle Habitat Camera
                </div>
            </div>

                    <!-- Camera Controls - 20vh -->
        <div class="camera-controls">
            <button class="control-btn" onclick="refreshCamera()">üîÑ Refresh</button>
            <button class="control-btn" onclick="switchCamera()">üì∑ Switch Camera</button>
            <button class="control-btn" onclick="takeSnapshot()">üì∏ Snapshot</button>
        </div>

        <!-- Navigation - 10vh -->
        <div class="navigation">
            <button class="nav-btn" onclick="showPage('status')">
                <div class="nav-icon">üè†</div>
                <div>STATUS</div>
            </button>
            <button class="nav-btn active" onclick="showPage('camera')">
                <div class="nav-icon">üìπ</div>
                <div>CAMERA</div>
            </button>
            <button class="nav-btn" onclick="showPage('data')">
                <div class="nav-icon">üìä</div>
                <div>DATA</div>
            </button>
        </div>
    </div>
</div>

    <!-- Page 3: Data & Logs -->
    <div class="page" id="data-page">
        <!-- Page Header - 10vh -->
        <div class="page-header">
            <h2>üìà Data Analysis & Activity Log</h2>
            <div>Last updated: <span id="last-update">Just now</span></div>
        </div>

        <!-- Data Charts - 35vh -->
        <div class="data-charts">
            <div class="chart-card">
                <div class="chart-title">üå°Ô∏è Temperature Trends</div>
                <div class="chart-values">
                    <div>Basking: <span id="chart-basking-temp">--¬∞F</span></div>
                    <div>Cool: <span id="chart-cooling-temp">--¬∞F</span></div>
                </div>
                <div class="chart-placeholder">[24H Graph Placeholder]</div>
            </div>
            <div class="chart-card">
                <div class="chart-title">üíß Humidity Trends</div>
                <div class="chart-values">
                    <div>Basking: <span id="chart-basking-humidity">--%</span></div>
                    <div>Cool: <span id="chart-cooling-humidity">--%</span></div>
                </div>
                <div class="chart-placeholder">[24H Graph Placeholder]</div>
            </div>
        </div>

        <!-- Activity Log - 35vh -->
        <div class="activity-log">
            <div class="log-header">
                <h4>üìã Recent Activity</h4>
                <div class="log-filters">
                    <button class="filter-btn active">All</button>
                    <button class="filter-btn">üî¥ Critical</button>
                    <button class="filter-btn">üü° Warning</button>
                    <button class="filter-btn">üîµ Info</button>
                </div>
            </div>
            <div class="log-entries" id="log-entries">
                <div class="log-entry">üü¢ System initialized - All sensors online</div>
                <div class="log-entry">üì° API connection established</div>
                <div class="log-entry">üå°Ô∏è Temperature reading: Basking 84.6¬∞F, Cool 84.8¬∞F</div>
                <div class="log-entry">üíß Humidity reading: Basking 38.6%, Cool 38.5%</div>
                <div class="log-entry">‚úÖ All systems operating normally</div>
            </div>
        </div>

        <!-- Navigation - 10vh -->
        <div class="navigation">
            <button class="nav-btn" onclick="showPage('status')">
                <div class="nav-icon">üè†</div>
                <div>STATUS</div>
            </button>
            <button class="nav-btn" onclick="showPage('camera')">
                <div class="nav-icon">üìπ</div>
                <div>CAMERA</div>
            </button>
            <button class="nav-btn active" onclick="showPage('data')">
                <div class="nav-icon">üìä</div>
                <div>DATA</div>
            </button>
        </div>
    </div>

    <script>
        let currentPage = 'status';

        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // Show target page
            document.getElementById(pageName + '-page').classList.add('active');

            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.nav-btn').classList.add('active');

            // Initialize camera when switching to camera page
            if (pageName === 'camera') {
                setTimeout(() => {
                    console.log('üìπ Refreshing camera on page switch...');
                    refreshCamera();
                }, 500);
            }

            currentPage = pageName;
            console.log('Switched to page:', pageName);
        }

        // API Configuration
        const API_BASE_URL = 'http://10.0.20.69/api';
        const API_ENDPOINTS = {
            latest: '/latest',
            health: '/health'
        };

        let isConnected = false;
        let lastDataUpdate = null;

        // Connection status update
        function updateConnectionStatus(connected) {
            isConnected = connected;
            const statusElement = document.querySelector('.connection-status');
            const iconElement = statusElement?.querySelector('.connection-icon');
            const textElement = statusElement?.querySelector('.connection-text');

            if (statusElement && iconElement && textElement) {
                statusElement.className = `connection-status ${connected ? 'connected' : 'disconnected'}`;
                iconElement.textContent = connected ? 'üì°' : '‚ùå';
                textElement.textContent = connected ? 'Connected' : 'Disconnected';
            }

            // Update network status indicator
            const networkStatus = document.getElementById('network-status');
            if (networkStatus) {
                networkStatus.textContent = connected ? 'OK' : 'OFF';
                networkStatus.className = `indicator-status ${connected ? 'status-excellent' : 'status-critical'}`;
            }
        }

        // Update sensor data
        function updateData() {
            fetch(`${API_BASE_URL}${API_ENDPOINTS.latest}`)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    console.log('üìä Received sensor data:', data);
                    
                    // Update connection status
                    updateConnectionStatus(true);
                    
                    // Update sensor readings
                    if (data.readings) {
                        const sensor1 = data.readings.sensor1;
                        const sensor2 = data.readings.sensor2;
                        
                        if (sensor1) {
                            document.getElementById('basking-temp').textContent = `${sensor1.temperature.toFixed(1)}¬∞F`;
                            document.getElementById('basking-humidity').textContent = `${sensor1.humidity.toFixed(1)}%`;
                            document.getElementById('chart-basking-temp').textContent = `${sensor1.temperature.toFixed(1)}¬∞F`;
                            document.getElementById('chart-basking-humidity').textContent = `${sensor1.humidity.toFixed(1)}%`;
                            
                            // Update status bar based on temperature
                            const baskingStatus = document.getElementById('basking-status');
                            if (sensor1.temperature >= 80 && sensor1.temperature <= 90) {
                                baskingStatus.className = 'status-bar status-excellent';
                            } else if (sensor1.temperature >= 75 && sensor1.temperature <= 95) {
                                baskingStatus.className = 'status-bar status-warning';
                            } else {
                                baskingStatus.className = 'status-bar status-critical';
                            }
                        }
                        
                        if (sensor2) {
                            document.getElementById('cooling-temp').textContent = `${sensor2.temperature.toFixed(1)}¬∞F`;
                            document.getElementById('cooling-humidity').textContent = `${sensor2.humidity.toFixed(1)}%`;
                            document.getElementById('chart-cooling-temp').textContent = `${sensor2.temperature.toFixed(1)}¬∞F`;
                            document.getElementById('chart-cooling-humidity').textContent = `${sensor2.humidity.toFixed(1)}%`;
                            
                            // Update status bar based on temperature
                            const coolingStatus = document.getElementById('cooling-status');
                            if (sensor2.temperature >= 70 && sensor2.temperature <= 80) {
                                coolingStatus.className = 'status-bar status-excellent';
                            } else if (sensor2.temperature >= 65 && sensor2.temperature <= 85) {
                                coolingStatus.className = 'status-bar status-warning';
                            } else {
                                coolingStatus.className = 'status-bar status-critical';
                            }
                        }
                    }
                    
                    // Update last update time
                    const lastUpdateElement = document.getElementById('last-update');
                    if (lastUpdateElement) {
                        lastUpdateElement.textContent = 'Just now';
                    }
                    
                    lastDataUpdate = new Date();
                })
                .catch(error => {
                    console.error('‚ùå Error fetching data:', error);
                    updateConnectionStatus(false);
                });
        }

        // Touch gesture navigation
        let startX = 0;
        document.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
        });

        document.addEventListener('touchend', (e) => {
            const endX = e.changedTouches[0].clientX;
            const deltaX = endX - startX;
            
            if (Math.abs(deltaX) > 50) {
                const pages = ['status', 'camera', 'data'];
                const currentIndex = pages.indexOf(currentPage);
                
                let newIndex;
                if (deltaX > 0 && currentIndex > 0) {
                    newIndex = currentIndex - 1; // Swipe right = previous page
                } else if (deltaX < 0 && currentIndex < pages.length - 1) {
                    newIndex = currentIndex + 1; // Swipe left = next page
                }
                
                if (newIndex !== undefined) {
                    showPage(pages[newIndex]);
                }
            }
        });

        // Moon Phase Calculations
        function getMoonPhase(date = new Date()) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();

            // Calculate days since known new moon (Jan 6, 2000)
            const knownNewMoon = new Date(2000, 0, 6);
            const daysSince = (date - knownNewMoon) / (1000 * 60 * 60 * 24);
            
            // Moon cycle is approximately 29.53 days
            const moonCycle = 29.530588853;
            const phase = (daysSince % moonCycle) / moonCycle;
            
            let phaseName, phaseIcon;
            
            if (phase < 0.0625 || phase >= 0.9375) {
                phaseName = "New Moon";
                phaseIcon = "üåë";
            } else if (phase < 0.1875) {
                phaseName = "Waxing Crescent";
                phaseIcon = "üåí";
            } else if (phase < 0.3125) {
                phaseName = "First Quarter";
                phaseIcon = "üåì";
            } else if (phase < 0.4375) {
                phaseName = "Waxing Gibbous";
                phaseIcon = "üåî";
            } else if (phase < 0.5625) {
                phaseName = "Full Moon";
                phaseIcon = "üåï";
            } else if (phase < 0.6875) {
                phaseName = "Waning Gibbous";
                phaseIcon = "üåñ";
            } else if (phase < 0.8125) {
                phaseName = "Last Quarter";
                phaseIcon = "üåó";
            } else {
                phaseName = "Waning Crescent";
                phaseIcon = "üåò";
            }
            
            // Calculate illumination percentage
            const illumination = Math.round((1 - Math.abs(phase - 0.5) * 2) * 100);
            
            return { phaseName, phaseIcon, illumination };
        }

        // Create twinkling star field
        function createStarField() {
            const starField = document.getElementById('star-field');
            if (!starField) return;
            
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starField.appendChild(star);
            }
        }

        // Create Nyan turtle star trail
        function createNyanStarOverlay() {
            const overlay = document.getElementById('nyan-star-overlay');
            if (!overlay) return;
            
            setInterval(() => {
                const star = document.createElement('div');
                star.className = 'nyan-star';
                star.textContent = '‚ú¶';
                star.style.left = '60%';
                star.style.top = '50%';
                overlay.appendChild(star);
                
                setTimeout(() => {
                    if (star.parentNode) {
                        star.parentNode.removeChild(star);
                    }
                }, 2000);
            }, 600); // Create new star every 600ms (less frequent, more natural)
        }

        // Update Moon Phase Display
        function updateMoonPhase() {
            const moonData = getMoonPhase();
            
            const moonIcon = document.getElementById('moon-icon');
            const moonInfo = document.getElementById('moon-info');
            const moonPhaseName = document.getElementById('moon-phase-name');

            if (moonIcon) moonIcon.textContent = moonData.phaseIcon;
            if (moonInfo) moonInfo.textContent = `${moonData.illumination}%`;
            if (moonPhaseName) moonPhaseName.textContent = moonData.phaseName;
            
            console.log(`üåô Moon Phase: ${moonData.phaseName} (${moonData.illumination}% illuminated)`);
        }

        // Camera Management
        let currentCamera = 0;
        const cameraUrls = [
            'http://10.0.20.69:8000/api/camera/stream',  // Primary MJPEG stream
            'http://10.0.20.69:8000/api/camera/live',    // Live still frames
            'http://10.0.20.69/api/camera/stream',       // Nginx proxy fallback
            '/api/camera/live'                           // Local fallback
        ];

        function initializeCamera() {
            console.log('üé• Initializing camera system...');
            tryNextCamera();
        }

        function tryNextCamera() {
            if (currentCamera >= cameraUrls.length) {
                showCameraError();
                return;
            }

            const url = cameraUrls[currentCamera];
            console.log(`üìπ Trying camera ${currentCamera + 1}/${cameraUrls.length}: ${url}`);
            
            const img = document.getElementById('camera-stream');
            const status = document.getElementById('camera-status');
            
            if (img && status) {
                img.onload = () => {
                    console.log(`‚úÖ Camera ${currentCamera + 1} working!`);
                    status.textContent = 'üìπ Camera Online';
                    status.className = 'camera-status online';
                    img.style.display = 'block';
                    document.getElementById('camera-placeholder').style.display = 'none';
                };
                
                img.onerror = () => {
                    console.log(`‚ùå Camera ${currentCamera + 1} failed`);
                    currentCamera++;
                    setTimeout(tryNextCamera, 1000);
                };
                
                img.src = url + '?t=' + Date.now();
            }
        }

        function refreshCamera() {
            console.log('üîÑ Refreshing camera...');
            const img = document.getElementById('camera-stream');
            if (img) {
                img.src = cameraUrls[currentCamera] + '?t=' + Date.now();
            }
        }

        function switchCamera() {
            console.log('üì∑ Switching camera...');
            currentCamera = (currentCamera + 1) % cameraUrls.length;
            tryNextCamera();
        }

        function takeSnapshot() {
            console.log('üì∏ Taking snapshot...');
            // This would integrate with the camera API to take a snapshot
            alert('Snapshot feature would be implemented here');
        }

        function showCameraError() {
            console.log('‚ùå All camera endpoints failed');
            const status = document.getElementById('camera-status');
            const img = document.getElementById('camera-stream');
            const placeholder = document.getElementById('camera-placeholder');
            
            if (status) status.textContent = 'üìπ Camera Offline';
            if (status) status.className = 'camera-status offline';
            if (img) img.style.display = 'none';
            if (placeholder) placeholder.style.display = 'block';
        }

        // Mock weather data (replace with real API)
        function updateWeather() {
            const mockWeather = {
                temp: Math.round(65 + Math.random() * 20),
                desc: ['Sunny', 'Partly Cloudy', 'Clear', 'Cloudy'][Math.floor(Math.random() * 4)],
                wind: Math.round(3 + Math.random() * 15),
                humidity: Math.round(40 + Math.random() * 40)
            };
            
            document.getElementById('weather-temp').textContent = `${mockWeather.temp}¬∞F`;
            document.getElementById('weather-desc').textContent = mockWeather.desc;
            document.getElementById('weather-wind').textContent = `${mockWeather.wind} mph`;
            document.getElementById('weather-humidity').textContent = `${mockWeather.humidity}%`;
        }

        // Initialize animations
        function initializeAnimations() {
            createStarField();
            createNyanStarOverlay();
            updateMoonPhase();
            
            // Update moon phase daily
            setInterval(updateMoonPhase, 24 * 60 * 60 * 1000);
        }

        // Initialize dashboard
        console.log('üê¢ TurtX Multi-Page Monitor initializing...');
        console.log('üîó API Endpoint:', `${API_BASE_URL}${API_ENDPOINTS.latest}`);
        console.log('üåü Initializing magical animations...');
        
        // Initialize animations first
        initializeAnimations();
        
        // Initialize camera system
        initializeCamera();
        
        // Initial data load
        updateData();
        updateWeather();
        
        // Update every 2 seconds
        const updateInterval = setInterval(updateData, 2000);
        
        // Update weather every 10 minutes
        setInterval(updateWeather, 600000);
        
        console.log('‚úÖ TurtX Dashboard loaded! Updating every 2 seconds...');
    </script>
</body>
</html>